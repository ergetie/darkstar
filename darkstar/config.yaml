# Darkstar Energy Manager - Home Assistant Add-on
# https://github.com/ergetie/darkstar

name: "Darkstar Energy Manager"
description: "AI-powered home battery optimization with MILP scheduling"
version: "2.4.2-beta"
slug: "darkstar"
url: "https://github.com/ergetie/darkstar"

# Supported architectures (armv7 dropped - package incompatibility)
arch:
  - amd64
  - aarch64

# Pre-built Docker images (built via GitHub Actions)
# HA uses the 'version' field as the image tag automatically
image: ghcr.io/ergetie/darkstar-{arch}

# Startup configuration
init: false
startup: application
boot: auto

# API Access (enables SUPERVISOR_TOKEN for automatic HA authentication)
homeassistant_api: true
hassio_api: true

# Web UI
webui: http://[HOST]:[PORT:5000]
ingress: true
ingress_port: 5000
ingress_stream: true
panel_icon: "mdi:battery-charging"
panel_title: "Darkstar"

# Ports
ports:
  5000/tcp: 5000
ports_description:
  5000/tcp: "Web UI"

# Configuration options (shown in HA Add-on UI)
options:
  timezone: "Europe/Stockholm"
  log_level: "info"
  price_area: "SE4"
  
  # Core sensor entities (entity picker dropdowns in HA UI)
  battery_soc_sensor: ""
  pv_production_sensor: ""
  load_consumption_sensor: ""
  
  # System profile (what hardware do you have?)
  has_solar: true
  has_battery: true
  has_water_heater: true

# Schema (validates options + enables entity selectors)
schema:
  timezone: str
  log_level: list(debug|info|warning|error)
  price_area: list(SE1|SE2|SE3|SE4|NO1|NO2|NO3|NO4|NO5|DK1|DK2|FI)
  
  # Entity selectors (native HA dropdowns!)
  battery_soc_sensor: str?
  pv_production_sensor: str?
  load_consumption_sensor: str?
  
  # Boolean toggles for system profile
  has_solar: bool
  has_battery: bool
  has_water_heater: bool

# Data persistence
map:
  - config:rw
  - share:rw

# Resource limits (optional, good for RPi)
# memory: 512m
