# General System Settings
timezone: "Europe/Stockholm"

# System Parameters
system:
  location:
    latitude: 59.3293
    longitude: 18.0686
  solar_array:
    kwp: 8.5
    azimuth: 180
    tilt: 35
  inverter:
    max_power_kw: 10.0
  grid:
    max_power_kw: 25.0

# Battery Specifications
battery:
  capacity_kwh: 10.0
  min_soc_percent: 15
  max_soc_percent: 95            # Planner target ceiling (BMS still enforces absolute limit)
  max_charge_power_kw: 5.0
  max_discharge_power_kw: 5.0
  efficiency_percent: 95.0       # Legacy field (maintained for backward compatibility)
  roundtrip_efficiency_percent: 95.0

battery_economics:
  battery_cycle_cost_kwh: 0.20      # Degradation cost applied per kWh cycled through the battery

# Decision Making Thresholds
decision_thresholds:
  battery_use_margin_sek: 0.10      # Use battery if grid > battery_cost + wear + margin
  export_profit_margin_sek: 0.05    # Additional profit required on top of battery cost + wear
  battery_water_margin_sek: 0.20    # Margin for using battery for water heating

# Charging Strategy
charging_strategy:
  charge_threshold_percentile: 15   # Bottom 15% of prices are considered 'cheap'
  cheap_price_tolerance_sek: 0.10   # Extends 'cheap' category to prices within this tolerance
  price_smoothing_sek_kwh: 0.05     # Allows grouping of slots slightly above cheapest price for block planning
  block_consolidation_tolerance_sek: 0.05  # Optional extra tolerance for consolidating charge blocks
  consolidation_max_gap_slots: 0     # Allow bridging up to N zero-capacity slots when consolidating

# Strategic Charging (Floor Price)
strategic_charging:
  price_threshold_sek: 0.90         # Price below which strategic charging is triggered
  target_soc_percent: 95            # Absolute SoC target for strategic charging
  carry_forward_tolerance_ratio: 0.10  # Allow next cheap window if its price within tolerance

# Water Heating
water_heating:
  power_kw: 3.0                     # Power consumption of the water heater
  min_hours_per_day: 2.0            # Minimum run-time per day
  min_kwh_per_day: 6.0              # Optional; defaults to power * hours when unset
  max_blocks_per_day: 2             # Prefer single block, up to two if needed
  schedule_future_only: true        # Only schedule future slots (skip current slot)
  defer_up_to_hours: 3              # Allow deferring into early tomorrow up to N hours if cheaper

# S-Index Configuration
s_index:
  mode: "static"                    # Options: static | dynamic
  static_factor: 1.05               # Used when mode=static
  base_factor: 1.05                 # Starting point for dynamic calculations
  max_factor: 1.50                  # Upper bound clamp for dynamic mode
  pv_deficit_weight: 0.30           # Weight for PV/load deficit contribution
  temp_weight: 0.20                 # Weight for temperature adjustment
  temp_baseline_c: 20               # Baseline temperature (no adjustment)
  temp_cold_c: -15                  # Temperature where adjustment reaches 100%
  days_ahead_for_sindex: [2, 3, 4]  # Day offsets (relative to today) to evaluate

# Smoothing / Hysteresis Controls
smoothing:
  min_on_slots_charge: 2
  min_off_slots_charge: 1
  min_on_slots_discharge: 2
  min_off_slots_discharge: 1
  min_on_slots_export: 2

# Arbitrage / Export Settings
arbitrage:
  enable_export: true
  export_fees_sek_per_kwh: 0.0
  export_profit_margin_sek: 0.05
  protective_soc_strategy: "gap_based"
  fixed_protective_soc_percent: 15.0
  export_percentile_threshold: 15        # Top X% of prices eligible for export
  enable_peak_only_export: true
  export_future_price_guard: true
  future_price_guard_buffer_sek: 0.00

# Debug & Telemetry
debug:
  enable_planner_debug: false
  sample_size: 30

# Learning Engine
learning:
  enable: true
  sqlite_path: "data/planner_learning.db"
  sync_interval_minutes: 5

# Nordpool API Configuration
nordpool:
  price_area: "SE4"
  currency: "SEK"
  resolution_minutes: 15

# Pricing Configuration
pricing:
  vat_percent: 25.0
  grid_transfer_fee_sek: 0.2456
  energy_tax_sek: 0.439

# Forecasting Adjustments
forecasting:
  pv_confidence_percent: 90.0
  load_safety_margin_percent: 110.0
